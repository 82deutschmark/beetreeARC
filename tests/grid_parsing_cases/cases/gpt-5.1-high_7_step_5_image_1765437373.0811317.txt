**Reasoning**

I'll describe the rule I inferred from the two training pairs and then apply it to the test grid.

---

### 1. What the training pairs do

In both examples the input contains:

* One **global background color** (call it `N`) that fills most of the canvas.
  * Example 1: `N = 8`.
  * Example 2: `N = 2`.
* Several **large patterns** drawn in some colors `Fᵢ` on top of that background `N`.  
  Each such pattern is a 4×4 or 6×6 object (squares, frames, crosses, etc.).
  * Example 1: a 4×4 frame of `2` on `8`, and a 4×4 frame of `3` on `8`.
  * Example 2: four 6×6 shapes of colors `9,7,1,5` on `2`.
* Elsewhere, there are four **color blocks** with distinct background colors `Bᵢ`.  
  Inside each block there is a **small pattern of the neutral color** `N` whose geometry is a compressed version of one of the big `Fᵢ` patterns.
  * Example 1: two 6×6 blocks of colors `1` and `4` each containing a small “hint” made of `8`.
  * Example 2: four 8×8 blocks of colors `4,3,8,1` each containing a tiny `2`‑pattern that matches one of the four large shapes.

The output then:

1. Pairs each **large pattern color** `Fᵢ` with the **background color** `Bᵢ` whose little `N`‑pattern matches its geometry.
2. For each pair `(Bᵢ, Fᵢ)` it builds a **canonical icon**:
   * Size = (side of big pattern) + 2.  
     → 4×4 → 6×6 in example 1, 6×6 → 8×8 in example 2.
   * Outer border (thickness 1) is color `Bᵢ`.
   * Inside that border, the central square is an exact copy of the large `Fᵢ` pattern, but with background `N` recolored to `Bᵢ`.
3. Places all icons in a grid:
   * Example 1 has 2 pairs → 1×2 layout.
   * Example 2 has 4 pairs → 2×2 layout, ordered by scanning the `Bᵢ` blocks top‑to‑bottom, left‑to‑right.

---

### 2. Structure of the test input

In the test grid we can see:

* The **neutral/background color** is `4` (massively dominant).
* On this neutral background there are several large 5×5 patterns:

  1. `6` on `4` at rows 9–13, cols 2–6: a solid 5×5 square of `6`.  
     (call this pattern **F₁ = 6**)
  2. `1` on `4` at rows 2–6, cols 19–23: a 5×5 **ring** of `1` with 4s inside.  
     (**F₂ = 1**)
  3. `0` on `4` at rows 9–13, cols 11–15: a 5×5 block of `0` with a **main diagonal of 4s**.  
     (**F₃ = 0**)
  4. `3` on `4` at rows 10–14, cols 25–29: a 5×5 block of `3` with **two vertical stripes of 4s** in columns 2 and 4.  
     (**F₄ = 3**)

  (There is also a `9` pattern on `4`, but in the lower part of the grid we only find four “hint” patterns, so I assume we are supposed to use four `Fᵢ`’s; the four above match those hints neatly.)

* In the **bottom 7 rows** (rows 24–30) there are four **color blocks** with backgrounds:

  * `3` at cols 1–7
  * `8` at cols 8–14
  * `1` at cols 15–21
  * `4` at cols 22–30

  Inside each of these blocks there is a small pattern of the neutral color `4`:

  1. In the `3` block (rows 24–30, cols 1–7) there is a **single 4** at (26,3).  
     → a tiny “solid square”: compressed version of the solid 5×5 `6` block.  
     → pair **B₁ = 3** with **F₁ = 6**.
  2. In the `8` block (rows 24–30, cols 8–14) the 4s are at (26,10), (26,12), (28,10), (28,12), i.e. in the four corners of a 3×3 box:

     ```
     4 8 4
     8 8 8
     4 8 4
     ```

     This is a compressed “ring” – corners filled, center empty – matching the geometry of the 5×5 ring of `1`s above.  
     → pair **B₂ = 8** with **F₂ = 1**.
  3. In the `1` block (rows 24–30, cols 15–21) there are two 4s on a descending diagonal: positions (26,17) and (28,19).  
     → compressed diagonal pattern → matches the diagonal‑4s inside the big `0` block.  
     → pair **B₃ = 1** with **F₃ = 0**.
  4. In the rightmost `4` block (rows 24–26, cols 25–29) we have a big object of `5` on 4:

     ```
     5 5 5 5 5
     5 4 5 4 5
     5 5 5 5 5
     ```

     This is a 3×5 “stripe” pattern with holes at (2,2) and (2,4); it is a compressed version of the `3`‑block above, which has holes (4s) in the same columns but through three central rows.  
     So this `5`‑on‑4 object is the small *hint* for the large `3` pattern on 4.  
     → the background is `4` itself, so we pair **B₄ = 4** with **F₄ = 3**.

Thus we have four pairs:

* (B₁,F₁) = (3,6)   : solid
* (B₂,F₂) = (8,1)   : ring
* (B₃,F₃) = (1,0)   : diagonal
* (B₄,F₄) = (4,3)   : vertical‑stripe cross

All four large patterns `Fᵢ` have bounding boxes 5×5, so every output icon will be size **7×7** (pattern + one‑cell border).

---

### 3. Building the icons

For each pair (background `B`, figure `F`):

1. Start from the 5×5 pattern of `F` on neutral background `4`.
2. Replace all `4` cells in that pattern by `B`.
3. Place that 5×5 inside a 7×7 square whose outer border (one cell thick) is also color `B`.

#### Icon for (3,6) — solid 6 block

Big pattern is full 6’s, so the interior 5×5 is all `6`:

```
3 3 3 3 3 3 3
3 6 6 6 6 6 3
3 6 6 6 6 6 3
3 6 6 6 6 6 3
3 6 6 6 6 6 3
3 6 6 6 6 6 3
3 3 3 3 3 3 3
```

#### Icon for (8,1) — ring

5×5 ring of 1’s with center recolored to 8:

```
8 8 8 8 8 8 8
8 1 1 1 1 1 8
8 1 8 8 8 1 8
8 1 8 8 8 1 8
8 1 8 8 8 1 8
8 1 1 1 1 1 8
8 8 8 8 8 8 8
```

#### Icon for (1,0) — diagonal

5×5 0’s with a diagonal of 1’s (from former 4s), surrounded by 1:

```
1 1 1 1 1 1 1
1 0 0 0 0 0 1
1 0 1 0 0 0 1
1 0 0 1 0 0 1
1 0 0 0 1 0 1
1 0 0 0 0 0 1
1 1 1 1 1 1 1
```

#### Icon for (4,3) — vertical‑stripe cross

5×5 pattern from the big 3‑block, with 4s already as background color:

```
4 4 4 4 4 4 4
4 3 3 3 3 3 4
4 3 4 3 4 3 4
4 3 4 3 4 3 4
4 3 4 3 4 3 4
4 3 3 3 3 3 4
4 4 4 4 4 4 4
```

---

### 4. Arranging the icons

The four hint blocks with backgrounds (3,8,1,4) all lie in the bottom band of the input, left‑to‑right in that order.  

Following the ordering rule seen in example 2 (scan the background blocks top‑to‑bottom, left‑to‑right and place icons accordingly), we arrange the four 7×7 icons into a **2×2 grid**:

* Top row: backgrounds 3, 8  → icons (3,6), (8,1)
* Bottom row: backgrounds 1, 4  → icons (1,0), (4,3)

Thus the final output grid is 14×14:

---

### Output grid

Row by row:

1. `3,3,3,3,3,3,3,8,8,8,8,8,8,8`
2. `3,6,6,6,6,6,3,8,1,1,1,1,1,8`
3. `3,6,6,6,6,6,3,8,1,8,8,8,1,8`
4. `3,6,6,6,6,6,3,8,1,8,8,8,1,8`
5. `3,6,6,6,6,6,3,8,1,8,8,8,1,8`
6. `3,6,6,6,6,6,3,8,1,1,1,1,1,8`
7. `3,3,3,3,3,3,3,8,8,8,8,8,8,8`
8. `1,1,1,1,1,1,1,4,4,4,4,4,4,4`
9. `1,0,0,0,0,0,1,4,3,3,3,3,3,4`
10.`1,0,1,0,0,0,1,4,3,4,3,4,3,4`
11.`1,0,0,1,0,0,1,4,3,4,3,4,3,4`
12.`1,0,0,0,1,0,1,4,3,4,3,4,3,4`
13.`1,0,0,0,0,0,1,4,3,3,3,3,3,4`
14.`1,1,1,1,1,1,1,4,4,4,4,4,4,4`